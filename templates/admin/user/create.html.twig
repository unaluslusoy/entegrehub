{% extends 'layout/_admin.html.twig' %}

{% block title %}Yeni Kullanıcı Ekle{% endblock %}

{% block page_title %}Yeni Kullanıcı Ekle{% endblock %}

{% block breadcrumb %}
    <li class="breadcrumb-item">
        <span class="bullet bg-gray-500 w-5px h-2px"></span>
    </li>
    <li class="breadcrumb-item text-muted">
        <a href="{{ path('admin_users') }}" class="text-muted text-hover-primary">Kullanıcılar</a>
    </li>
    <li class="breadcrumb-item">
        <span class="bullet bg-gray-500 w-5px h-2px"></span>
    </li>
    <li class="breadcrumb-item text-muted">Yeni Kullanıcı</li>
{% endblock %}

{% block toolbar %}
    <div class="d-flex align-items-center gap-2 gap-lg-3">
        <a href="{{ path('admin_users') }}" class="btn btn-sm btn-light">
            <i class="ki-duotone ki-left fs-2"></i>
            Geri Dön
        </a>
    </div>
{% endblock %}

{% block content %}
    <form method="POST" action="{{ path('admin_users_create') }}" id="kt_user_create_form">
        <div class="row g-5 g-xl-10">
            <!--begin::User Info Card-->
            <div class="col-xl-8">
                <div class="card card-flush mb-5 mb-xl-10">
                    <div class="card-header">
                        <div class="card-title">
                            <h3 class="fw-bold m-0">Kullanıcı Bilgileri</h3>
                        </div>
                    </div>
                    <div class="card-body pt-0">
                        <!--begin::Name-->
                        <div class="row mb-7">
                            <div class="col-md-6 fv-row">
                                <label class="form-label fw-bold fs-6 required">Ad</label>
                                <input type="text" 
                                       name="first_name" 
                                       class="form-control form-control-solid form-control-lg" 
                                       placeholder="Kullanıcının adı"
                                       required />
                                <div class="fv-plugins-message-container invalid-feedback"></div>
                            </div>
                            <div class="col-md-6 fv-row">
                                <label class="form-label fw-bold fs-6 required">Soyad</label>
                                <input type="text" 
                                       name="last_name" 
                                       class="form-control form-control-solid form-control-lg" 
                                       placeholder="Kullanıcının soyadı"
                                       required />
                                <div class="fv-plugins-message-container invalid-feedback"></div>
                            </div>
                        </div>
                        <!--end::Name-->

                        <!--begin::Email-->
                        <div class="fv-row mb-7">
                            <label class="form-label fw-bold fs-6 required">E-posta Adresi</label>
                            <input type="email" 
                                   name="email" 
                                   class="form-control form-control-solid form-control-lg" 
                                   placeholder="user@example.com"
                                   required />
                            <div class="form-text">Giriş için kullanılacak benzersiz e-posta adresi</div>
                            <div class="fv-plugins-message-container invalid-feedback"></div>
                        </div>
                        <!--end::Email-->

                        <!--begin::Password-->
                        <div class="fv-row mb-7">
                            <label class="form-label fw-bold fs-6 required">Şifre</label>
                            <div class="position-relative mb-3">
                                <input type="password" 
                                       name="password" 
                                       class="form-control form-control-solid form-control-lg" 
                                       placeholder="••••••••"
                                       required 
                                       minlength="8"
                                       autocomplete="off" />
                                <span class="btn btn-sm btn-icon position-absolute translate-middle top-50 end-0 me-n2" 
                                      data-kt-password-meter-control="visibility">
                                    <i class="ki-duotone ki-eye-slash fs-1">
                                        <span class="path1"></span>
                                        <span class="path2"></span>
                                        <span class="path3"></span>
                                        <span class="path4"></span>
                                    </i>
                                    <i class="ki-duotone ki-eye fs-1 d-none">
                                        <span class="path1"></span>
                                        <span class="path2"></span>
                                        <span class="path3"></span>
                                    </i>
                                </span>
                            </div>
                            <div class="d-flex align-items-center mb-3" data-kt-password-meter="true">
                                <div class="flex-grow-1 bg-secondary bg-active-success rounded h-5px me-2">
                                    <div class="bg-active-success rounded h-5px" role="progressbar" style="width: 0%"></div>
                                </div>
                                <div class="text-muted">Zayıf</div>
                            </div>
                            <div class="text-muted">En az 8 karakter, büyük/küçük harf ve rakam içermelidir</div>
                            <div class="fv-plugins-message-container invalid-feedback"></div>
                        </div>
                        <!--end::Password-->

                        <!--begin::Phone-->
                        <div class="fv-row mb-7">
                            <label class="form-label fw-bold fs-6">Telefon Numarası</label>
                            <div class="input-group input-group-solid">
                                <span class="input-group-text">
                                    <i class="ki-duotone ki-phone fs-2">
                                        <span class="path1"></span>
                                        <span class="path2"></span>
                                    </i>
                                </span>
                                <input type="text" 
                                       name="phone" 
                                       class="form-control form-control-solid form-control-lg" 
                                       placeholder="+90 (5xx) xxx xx xx"
                                       data-inputmask="'mask': '+90 (999) 999 99 99'" />
                            </div>
                            <div class="form-text">İletişim için kullanılacak telefon numarası (opsiyonel)</div>
                        </div>
                        <!--end::Phone-->
                    </div>
                </div>
            </div>
            <!--end::User Info Card-->

            <!--begin::Settings Card-->
            <div class="col-xl-4">
                <div class="card card-flush mb-5 mb-xl-10">
                    <div class="card-header">
                        <div class="card-title">
                            <h3 class="fw-bold m-0">Yetki & Ayarlar</h3>
                        </div>
                    </div>
                    <div class="card-body pt-0">
                        <!--begin::Role-->
                        <div class="fv-row mb-7">
                            <label class="form-label fw-bold fs-6 required">Kullanıcı Rolü</label>
                            <select name="role" 
                                    class="form-select form-select-solid form-select-lg" 
                                    data-control="select2"
                                    data-placeholder="Rol seçin"
                                    data-hide-search="true"
                                    required>
                                <option></option>
                                <option value="ROLE_USER">Kullanıcı</option>
                                <option value="ROLE_SUPER_ADMIN" selected>Admin</option>
                                <option value="ROLE_SUPER_ADMIN">Süper Admin</option>
                            </select>
                            <div class="form-text">Kullanıcının sistem üzerindeki yetki seviyesi</div>
                            <div class="fv-plugins-message-container invalid-feedback"></div>
                        </div>
                        <!--end::Role-->

                        <!--begin::Status-->
                        <div class="fv-row mb-7">
                            <label class="form-label fw-bold fs-6">Hesap Durumu</label>
                            <div class="form-check form-switch form-check-custom form-check-solid mt-2">
                                <input class="form-check-input" 
                                       type="checkbox" 
                                       name="is_active" 
                                       value="1" 
                                       id="kt_user_is_active"
                                       checked />
                                <label class="form-check-label text-gray-600 fw-semibold" for="kt_user_is_active">
                                    Aktif
                                </label>
                            </div>
                            <div class="form-text">Hesap devre dışı bırakılırsa kullanıcı giriş yapamaz</div>
                        </div>
                        <!--end::Status-->

                        <!--begin::Notifications-->
                        <div class="fv-row mb-7">
                            <label class="form-label fw-bold fs-6">Bildirimler</label>
                            <div class="form-check form-check-custom form-check-solid mt-2 mb-3">
                                <input class="form-check-input" 
                                       type="checkbox" 
                                       name="email_notifications" 
                                       value="1" 
                                       id="kt_user_email_notifications"
                                       checked />
                                <label class="form-check-label text-gray-700" for="kt_user_email_notifications">
                                    E-posta bildirimleri
                                </label>
                            </div>
                            <div class="form-check form-check-custom form-check-solid">
                                <input class="form-check-input" 
                                       type="checkbox" 
                                       name="sms_notifications" 
                                       value="1" 
                                       id="kt_user_sms_notifications" />
                                <label class="form-check-label text-gray-700" for="kt_user_sms_notifications">
                                    SMS bildirimleri
                                </label>
                            </div>
                        </div>
                        <!--end::Notifications-->

                        <!--begin::Actions-->
                        <div class="d-flex flex-column gap-3">
                            <button type="submit" class="btn btn-primary" data-kt-user-action="submit">
                                <span class="indicator-label">
                                    <i class="ki-duotone ki-check fs-2"></i>
                                    Kullanıcı Oluştur
                                </span>
                                <span class="indicator-progress">
                                    Lütfen bekleyin... <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                                </span>
                            </button>
                            <a href="{{ path('admin_users') }}" class="btn btn-light">
                                <i class="ki-duotone ki-cross fs-2">
                                    <span class="path1"></span>
                                    <span class="path2"></span>
                                </i>
                                İptal
                            </a>
                        </div>
                        <!--end::Actions-->
                    </div>
                </div>

                <!--begin::Info Card-->
                <div class="card card-flush">
                    <div class="card-body p-9">
                        <div class="notice d-flex bg-light-primary rounded border-primary border border-dashed p-6">
                            <i class="ki-duotone ki-information fs-2tx text-primary me-4">
                                <span class="path1"></span>
                                <span class="path2"></span>
                                <span class="path3"></span>
                            </i>
                            <div class="d-flex flex-stack flex-grow-1">
                                <div class="fw-semibold">
                                    <h4 class="text-gray-900 fw-bold">Bilgilendirme</h4>
                                    <div class="fs-6 text-gray-700">
                                        Yeni kullanıcıya otomatik olarak hoşgeldin e-postası gönderilecektir.
                                        <a href="#" class="fw-bold">Daha fazla bilgi</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--end::Info Card-->
            </div>
            <!--end::Settings Card-->
        </div>
    </form>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Password visibility toggle
            document.querySelectorAll('[data-kt-password-meter-control="visibility"]').forEach(function(toggle) {
                toggle.addEventListener('click', function() {
                    const wrapper = this.closest('.position-relative');
                    const input = wrapper.querySelector('input');
                    const eyeSlash = this.querySelector('.ki-eye-slash');
                    const eye = this.querySelector('.ki-eye');
                    
                    if (input.type === 'password') {
                        input.type = 'text';
                        eyeSlash.classList.add('d-none');
                        eye.classList.remove('d-none');
                    } else {
                        input.type = 'password';
                        eyeSlash.classList.remove('d-none');
                        eye.classList.add('d-none');
                    }
                });
            });

            // Password strength meter
            const passwordInput = document.querySelector('input[name="password"]');
            if (passwordInput) {
                passwordInput.addEventListener('input', function() {
                    const password = this.value;
                    const meter = document.querySelector('[data-kt-password-meter="true"]');
                    if (!meter) return;

                    const progressBar = meter.querySelector('[role="progressbar"]');
                    const label = meter.querySelector('.text-muted');
                    
                    let strength = 0;
                    if (password.length >= 8) strength += 25;
                    if (/[a-z]/.test(password)) strength += 25;
                    if (/[A-Z]/.test(password)) strength += 25;
                    if (/[0-9]/.test(password)) strength += 25;
                    
                    progressBar.style.width = strength + '%';
                    
                    if (strength < 50) {
                        label.textContent = 'Zayıf';
                        meter.className = 'd-flex align-items-center mb-3';
                    } else if (strength < 75) {
                        label.textContent = 'Orta';
                        meter.className = 'd-flex align-items-center mb-3 text-warning';
                    } else {
                        label.textContent = 'Güçlü';
                        meter.className = 'd-flex align-items-center mb-3 text-success';
                    }
                });
            }

            // Form submission with loading state
            const form = document.getElementById('kt_user_create_form');
            if (form) {
                form.addEventListener('submit', function() {
                    const submitBtn = this.querySelector('[data-kt-user-action="submit"]');
                    if (submitBtn) {
                        submitBtn.disabled = true;
                        submitBtn.querySelector('.indicator-label').classList.add('d-none');
                        submitBtn.querySelector('.indicator-progress').classList.remove('d-none');
                    }
                });
            }

            // Input mask for phone
            if (typeof Inputmask !== 'undefined') {
                const phoneInput = document.querySelector('input[data-inputmask]');
                if (phoneInput) {
                    Inputmask().mask(phoneInput);
                }
            }
        });
    </script>
{% endblock %}
