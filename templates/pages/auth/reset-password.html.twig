{% extends "#{theme.getParameter('KT_THEME_LAYOUT_DIR')}/_auth.html.twig" %}

{% block page_title %}Şifre Sıfırlama{% endblock %}

{% block content %}

    <!--begin::Form-->
    <form class="form w-100" novalidate="novalidate" id="kt_password_reset_form" method="POST" action="{{ path('app_forgot_password') }}">
        <!--begin::Heading-->
        <div class="text-center mb-10">
            <!--begin::Title-->
            <h1 class="text-gray-900 fw-bolder mb-3">
                Şifrenizi mi Unuttunuz?
            </h1>
            <!--end::Title-->

            <!--begin::Link-->
            <div class="text-gray-500 fw-semibold fs-6">
                E-posta adresinizi girin, size şifre sıfırlama bağlantısı gönderelim.
            </div>
            <!--end::Link-->
        </div>
        <!--begin::Heading-->

        {% include 'partials/_flash_messages.html.twig' %}

        <!--begin::Input group--->
        <div class="fv-row mb-8">
            <!--begin::Email-->
            <input type="email" placeholder="E-posta Adresi" name="email" autocomplete="email" required class="form-control bg-transparent"/>
            <!--end::Email-->
        </div>

        <!--begin::CSRF Token-->
        <input type="hidden" name="_csrf_token" value="{{ csrf_token('reset_password') }}">
        <!--end::CSRF Token-->

        <!--begin::Actions-->
        <div class="d-flex flex-wrap justify-content-center pb-lg-0 gap-3">
            <button type="submit" id="kt_password_reset_submit" class="btn btn-primary">
                <span class="indicator-label">Sıfırlama Bağlantısı Gönder</span>
                <span class="indicator-progress">Gönderiliyor...
                <span class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
            </button>

            <a href="{{ path('app_login') }}" class="btn btn-light">Giriş Sayfasına Dön</a>
        </div>
        <!--end::Actions-->
    </form>
    <!--end::Form-->

    <!--begin::Javascript-->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('kt_password_reset_form');
            const submitButton = document.getElementById('kt_password_reset_submit');
            const emailInput = form.querySelector('input[name="email"]');
            
            // Form validation
            form.addEventListener('submit', function(e) {
                // Reset previous errors
                emailInput.classList.remove('is-invalid');
                
                // Validate email
                if (!emailInput.value.trim()) {
                    e.preventDefault();
                    emailInput.classList.add('is-invalid');
                    showError('Lütfen e-posta adresinizi girin.');
                    return;
                }
                
                if (!isValidEmail(emailInput.value)) {
                    e.preventDefault();
                    emailInput.classList.add('is-invalid');
                    showError('Lütfen geçerli bir e-posta adresi girin.');
                    return;
                }
                
                // Show loading state
                submitButton.setAttribute('data-kt-indicator', 'on');
                submitButton.disabled = true;
            });
            
            // Email validation helper
            function isValidEmail(email) {
                return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            }
            
            // Show error message
            function showError(message) {
                const existingAlert = form.querySelector('.validation-alert');
                if (existingAlert) {
                    existingAlert.remove();
                }
                
                const alert = document.createElement('div');
                alert.className = 'alert alert-dismissible bg-light-danger d-flex flex-column flex-sm-row p-5 mb-10 validation-alert';
                alert.innerHTML = `
                    <i class="ki-duotone ki-information fs-2hx text-danger me-4 mb-5 mb-sm-0">
                        <span class="path1"></span>
                        <span class="path2"></span>
                        <span class="path3"></span>
                    </i>
                    <div class="d-flex flex-column pe-0 pe-sm-10">
                        <span class="fw-semibold">${message}</span>
                    </div>
                    <button type="button" class="position-absolute position-sm-relative m-2 m-sm-0 top-0 end-0 btn btn-icon ms-sm-auto" data-bs-dismiss="alert">
                        <i class="ki-duotone ki-cross fs-1 text-danger">
                            <span class="path1"></span>
                            <span class="path2"></span>
                        </i>
                    </button>
                `;
                
                const firstInput = form.querySelector('.fv-row');
                firstInput.parentNode.insertBefore(alert, firstInput);
            }
        });
    </script>
    <!--end::Javascript-->

{% endblock %}