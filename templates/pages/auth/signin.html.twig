{% extends "#{theme.getParameter('KT_THEME_LAYOUT_DIR')}/_auth.html.twig" %}

{% block page_title %}{{ 'login.title'|trans }}{% endblock %}

{% block content %}

    <!--begin::Form-->
    <form class="form w-100" novalidate="novalidate" id="kt_sign_in_form" method="POST" action="{{ path('app_login') }}">
        <!--begin::Heading-->
        <div class="text-center mb-11">
            <!--begin::Title-->
            <h1 class="text-gray-900 fw-bolder mb-3">
                {{ 'login.title'|trans }}
            </h1>
            <!--end::Title-->

            <!--begin::Subtitle-->
            <div class="text-gray-500 fw-semibold fs-6">
                {{ 'login.subtitle'|trans }}
            </div>
            <!--end::Subtitle--->
        </div>
        <!--begin::Heading-->

        <!--begin::Login options-->
        <div class="row g-3 mb-9">
            <!--begin::Col-->
            <div class="col-md-4">
                <!--begin::Google link--->
                <a href="{{ path('oauth_connect_google') }}" class="btn btn-flex btn-outline btn-text-gray-700 btn-active-color-primary bg-state-light flex-center text-nowrap w-100">
                    <img alt="Logo" src="{{ theme.image('svg/brand-logos/google-icon.svg') }}" class="h-15px me-3"/>
                    Google
                </a>
                <!--end::Google link--->
            </div>
            <!--end::Col-->

            <!--begin::Col-->
            <div class="col-md-4">
                <!--begin::Apple link--->
                <a href="{{ path('oauth_connect_apple') }}" class="btn btn-flex btn-outline btn-text-gray-700 btn-active-color-primary bg-state-light flex-center text-nowrap w-100">
                    <img alt="Logo" src="{{ theme.image('svg/brand-logos/apple-black.svg') }}" class="theme-light-show h-15px me-3"/>
                    <img alt="Logo" src="{{ theme.image('svg/brand-logos/apple-black-dark.svg') }}" class="theme-dark-show h-15px me-3"/>
                    Apple
                </a>
                <!--end::Apple link--->
            </div>
            <!--end::Col-->

            <!--begin::Col-->
            <div class="col-md-4">
                <!--begin::Shopify link--->
                <a href="{{ path('shopify_oauth_connect') }}" class="btn btn-flex btn-outline btn-text-gray-700 btn-active-color-primary bg-state-light flex-center text-nowrap w-100">
                    <img alt="Shopify" src="/assets/media/svg/brand-logos/shopify.svg" class="h-15px me-3"/>
                    Shopify
                </a>
                <!--end::Shopify link--->
            </div>
            <!--end::Col-->
        </div>
        <!--end::Login options-->

        <!--begin::Separator-->
        <div class="separator separator-content my-14">
            <span class="w-125px text-gray-500 fw-semibold fs-7">{{ 'login.or_with_email'|trans }}</span>
        </div>
        <!--end::Separator-->

        {% include 'partials/_flash_messages.html.twig' %}

        {% if error %}
            <!--begin::Alert-->
            <div class="alert alert-dismissible bg-light-danger d-flex flex-column flex-sm-row p-5 mb-10">
                <!--begin::Icon-->
                <i class="ki-duotone ki-cross-circle fs-2hx text-danger me-4 mb-5 mb-sm-0">
                    <span class="path1"></span>
                    <span class="path2"></span>
                </i>
                <!--end::Icon-->
                
                <!--begin::Wrapper-->
                <div class="d-flex flex-column pe-0 pe-sm-10">
                    <h4 class="fw-semibold mb-1">{{ 'login.error_title'|trans }}</h4>
                    <span>{{ error.messageKey|trans(error.messageData, 'security') }}</span>
                </div>
                <!--end::Wrapper-->
                
                <!--begin::Close-->
                <button type="button" class="position-absolute position-sm-relative m-2 m-sm-0 top-0 end-0 btn btn-icon ms-sm-auto" data-bs-dismiss="alert">
                    <i class="ki-duotone ki-cross fs-1 text-danger">
                        <span class="path1"></span>
                        <span class="path2"></span>
                    </i>
                </button>
                <!--end::Close-->
            </div>
            <!--end::Alert-->
        {% endif %}

        <!--begin::Input group--->
        <div class="fv-row mb-8">
            <!--begin::Email-->
            <input type="email" placeholder="{{ 'login.email'|trans }}" name="_username" value="{{ last_username }}" autocomplete="email" required class="form-control bg-transparent"/>
            <!--end::Email-->
        </div>

        <!--end::Input group--->
        <div class="fv-row mb-3">
            <!--begin::Password-->
            <input type="password" placeholder="{{ 'login.password'|trans }}" name="_password" autocomplete="current-password" required class="form-control bg-transparent"/>
            <!--end::Password-->
        </div>
        <!--end::Input group--->
        
        <!--begin::CSRF Token-->
        <input type="hidden" name="_csrf_token" value="{{ csrf_token('authenticate') }}">
        <!--end::CSRF Token-->

        <!--begin::Wrapper-->
        <div class="d-flex flex-stack flex-wrap gap-3 fs-base fw-semibold mb-8">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" name="_remember_me" id="remember_me">
                <label class="form-check-label text-gray-700" for="remember_me">
                    {{ 'login.remember_me'|trans }}
                </label>
            </div>

            <!--begin::Link-->
            <a href="{{ path('app_forgot_password') }}" class="link-primary">
                {{ 'login.forgot_password'|trans }}
            </a>
            <!--end::Link-->
        </div>
        <!--end::Wrapper-->

        <!--begin::Submit button-->
        <div class="d-grid mb-10">
            <button type="submit" id="kt_sign_in_submit" class="btn btn-primary">
                <span class="indicator-label">{{ 'login.submit'|trans }}</span>
                <span class="indicator-progress">Lütfen bekleyin...
                <span class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
            </button>
        </div>
        <!--end::Submit button-->

        <!--begin::Sign up-->
        <div class="text-gray-500 text-center fw-semibold fs-6">
            {{ 'login.no_account'|trans }}

            <a href="{{ path('app_register') }}" class="link-primary fw-bold">
                {{ 'login.register_link'|trans }}
            </a>
        </div>
        <!--end::Sign up-->
    </form>
    <!--end::Form-->

    <!--begin::Javascript-->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('kt_sign_in_form');
            const submitButton = document.getElementById('kt_sign_in_submit');
            const emailInput = form.querySelector('input[name="_username"]');
            const passwordInput = form.querySelector('input[name="_password"]');
            
            // Form validation
            form.addEventListener('submit', function(e) {
                let isValid = true;
                
                // Reset previous errors
                emailInput.classList.remove('is-invalid');
                passwordInput.classList.remove('is-invalid');
                
                // Validate email
                if (!emailInput.value.trim()) {
                    e.preventDefault();
                    emailInput.classList.add('is-invalid');
                    showError('Lütfen e-posta adresinizi girin.');
                    isValid = false;
                } else if (!isValidEmail(emailInput.value)) {
                    e.preventDefault();
                    emailInput.classList.add('is-invalid');
                    showError('Lütfen geçerli bir e-posta adresi girin.');
                    isValid = false;
                }
                
                // Validate password
                if (!passwordInput.value.trim()) {
                    e.preventDefault();
                    passwordInput.classList.add('is-invalid');
                    showError('Lütfen şifrenizi girin.');
                    isValid = false;
                }
                
                // Show loading state if valid
                if (isValid) {
                    submitButton.setAttribute('data-kt-indicator', 'on');
                    submitButton.disabled = true;
                }
            });
            
            // Email validation helper
            function isValidEmail(email) {
                return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            }
            
            // Show error message
            function showError(message) {
                // Remove any existing error alerts
                const existingAlert = form.querySelector('.validation-alert');
                if (existingAlert) {
                    existingAlert.remove();
                }
                
                // Create new alert
                const alert = document.createElement('div');
                alert.className = 'alert alert-dismissible bg-light-danger d-flex flex-column flex-sm-row p-5 mb-10 validation-alert';
                alert.innerHTML = `
                    <i class="ki-duotone ki-information fs-2hx text-danger me-4 mb-5 mb-sm-0">
                        <span class="path1"></span>
                        <span class="path2"></span>
                        <span class="path3"></span>
                    </i>
                    <div class="d-flex flex-column pe-0 pe-sm-10">
                        <span class="fw-semibold">${message}</span>
                    </div>
                    <button type="button" class="position-absolute position-sm-relative m-2 m-sm-0 top-0 end-0 btn btn-icon ms-sm-auto" data-bs-dismiss="alert">
                        <i class="ki-duotone ki-cross fs-1 text-danger">
                            <span class="path1"></span>
                            <span class="path2"></span>
                        </i>
                    </button>
                `;
                
                // Insert before first input group
                const firstInput = form.querySelector('.fv-row');
                firstInput.parentNode.insertBefore(alert, firstInput);
            }
        });
    </script>
    <!--end::Javascript-->

{% endblock %}