{% extends "#{theme.getParameter('KT_THEME_LAYOUT_DIR')}/_auth.html.twig" %}

{% block page_title %}Yeni Şifre{% endblock %}

{% block content %}

    <!--begin::Form-->
    <form class="form w-100" novalidate="novalidate" id="kt_new_password_form" method="POST" action="{{ path('app_reset_password_token', {token: token ?? ''}) }}">
        <!--begin::Heading-->
        <div class="text-center mb-10">
            <!--begin::Title-->
            <h1 class="text-gray-900 fw-bolder mb-3">
                Yeni Şifre Oluştur
            </h1>
            <!--end::Title-->

            <!--begin::Link-->
            <div class="text-gray-500 fw-semibold fs-6">
                Güçlü bir şifre seçin ve hesabınızı güvende tutun.
            </div>
            <!--end::Link-->
        </div>
        <!--begin::Heading-->

        {% include 'partials/_flash_messages.html.twig' %}

        <!--begin::Input group-->
        <div class="fv-row mb-8" data-kt-password-meter="true">
            <!--begin::Wrapper-->
            <div class="mb-1">
                <!--begin::Input wrapper-->
                <div class="position-relative mb-3">
                    <input class="form-control bg-transparent" type="password" placeholder="Yeni Şifre" name="password" autocomplete="new-password" required/>

                    <span class="btn btn-sm btn-icon position-absolute translate-middle top-50 end-0 me-n2" data-kt-password-meter-control="visibility">
                        <i class="ki-duotone ki-eye-slash fs-2">
                            <span class="path1"></span>
                            <span class="path2"></span>
                            <span class="path3"></span>
                            <span class="path4"></span>
                        </i>
                        <i class="ki-duotone ki-eye fs-2 d-none">
                            <span class="path1"></span>
                            <span class="path2"></span>
                            <span class="path3"></span>
                        </i>
                    </span>
                </div>
                <!--end::Input wrapper-->

                <!--begin::Meter-->
                <div class="d-flex align-items-center mb-3" data-kt-password-meter-control="highlight">
                    <div class="flex-grow-1 bg-secondary bg-active-success rounded h-5px me-2"></div>
                    <div class="flex-grow-1 bg-secondary bg-active-success rounded h-5px me-2"></div>
                    <div class="flex-grow-1 bg-secondary bg-active-success rounded h-5px me-2"></div>
                    <div class="flex-grow-1 bg-secondary bg-active-success rounded h-5px"></div>
                </div>
                <!--end::Meter-->
            </div>
            <!--end::Wrapper-->

            <!--begin::Hint-->
            <div class="text-muted">
                En az 8 karakter, büyük-küçük harf, rakam ve özel karakter kullanın.
            </div>
            <!--end::Hint-->
        </div>
        <!--end::Input group--->

        <!--end::Input group--->
        <div class="fv-row mb-8">
            <!--begin::Repeat Password-->
            <input type="password" placeholder="Şifreyi Tekrarla" name="password_confirm" autocomplete="new-password" required class="form-control bg-transparent"/>
            <!--end::Repeat Password-->
        </div>
        <!--end::Input group--->

        <!--begin::CSRF Token-->
        <input type="hidden" name="_csrf_token" value="{{ csrf_token('reset_password') }}">
        <!--end::CSRF Token-->

        <!--begin::Action-->
        <div class="d-grid mb-10">
            <button type="submit" id="kt_new_password_submit" class="btn btn-primary">
                <span class="indicator-label">Şifreyi Güncelle</span>
                <span class="indicator-progress">Güncelleniyor...
                <span class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
            </button>
        </div>
        <!--end::Action-->
        
        <!--begin::Link-->
        <div class="text-center">
            <a href="{{ path('app_login') }}" class="link-primary fw-semibold">
                Giriş sayfasına dön
            </a>
        </div>
        <!--end::Link-->
    </form>
    <!--end::Form-->

    <!--begin::Javascript-->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('kt_new_password_form');
            const submitButton = document.getElementById('kt_new_password_submit');
            const passwordInput = form.querySelector('input[name="password"]');
            const confirmInput = form.querySelector('input[name="password_confirm"]');
            
            // Password visibility toggle
            const visibilityToggle = form.querySelector('[data-kt-password-meter-control="visibility"]');
            if (visibilityToggle) {
                visibilityToggle.addEventListener('click', function() {
                    const type = passwordInput.getAttribute('type');
                    passwordInput.setAttribute('type', type === 'password' ? 'text' : 'password');
                    
                    const eyeSlash = this.querySelector('.ki-eye-slash');
                    const eye = this.querySelector('.ki-eye');
                    eyeSlash.classList.toggle('d-none');
                    eye.classList.toggle('d-none');
                });
            }
            
            // Form validation
            form.addEventListener('submit', function(e) {
                passwordInput.classList.remove('is-invalid');
                confirmInput.classList.remove('is-invalid');
                
                if (!passwordInput.value.trim()) {
                    e.preventDefault();
                    passwordInput.classList.add('is-invalid');
                    showError('Lütfen yeni şifrenizi girin.');
                    return;
                }
                
                if (passwordInput.value.length < 8) {
                    e.preventDefault();
                    passwordInput.classList.add('is-invalid');
                    showError('Şifreniz en az 8 karakter olmalıdır.');
                    return;
                }
                
                if (!confirmInput.value.trim()) {
                    e.preventDefault();
                    confirmInput.classList.add('is-invalid');
                    showError('Lütfen şifrenizi tekrar girin.');
                    return;
                }
                
                if (passwordInput.value !== confirmInput.value) {
                    e.preventDefault();
                    confirmInput.classList.add('is-invalid');
                    showError('Girdiğiniz şifreler eşleşmiyor.');
                    return;
                }
                
                submitButton.setAttribute('data-kt-indicator', 'on');
                submitButton.disabled = true;
            });
            
            function showError(message) {
                const existingAlert = form.querySelector('.validation-alert');
                if (existingAlert) {
                    existingAlert.remove();
                }
                
                const alert = document.createElement('div');
                alert.className = 'alert alert-dismissible bg-light-danger d-flex flex-column flex-sm-row p-5 mb-10 validation-alert';
                alert.innerHTML = `
                    <i class="ki-duotone ki-information fs-2hx text-danger me-4 mb-5 mb-sm-0">
                        <span class="path1"></span>
                        <span class="path2"></span>
                        <span class="path3"></span>
                    </i>
                    <div class="d-flex flex-column pe-0 pe-sm-10">
                        <span class="fw-semibold">${message}</span>
                    </div>
                    <button type="button" class="position-absolute position-sm-relative m-2 m-sm-0 top-0 end-0 btn btn-icon ms-sm-auto" data-bs-dismiss="alert">
                        <i class="ki-duotone ki-cross fs-1 text-danger">
                            <span class="path1"></span>
                            <span class="path2"></span>
                        </i>
                    </button>
                `;
                
                const firstInput = form.querySelector('.fv-row');
                firstInput.parentNode.insertBefore(alert, firstInput);
            }
        });
    </script>
    <!--end::Javascript-->

{% endblock %}